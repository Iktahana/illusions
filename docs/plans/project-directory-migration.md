# Illusions ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç§»è¡Œè¨ˆç”»

**ä½œæˆæ—¥**: 2026-02-06  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ“‹ Planning Phase

---

## ğŸ“Œ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

Illusionsã‚’**å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«(.mdi)ç®¡ç†**ã‹ã‚‰**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç®¡ç†**ã¸ç§»è¡Œã—ã€å±¥æ­´ç®¡ç†ãƒ»ã‚¢ã‚»ãƒƒãƒˆç®¡ç†ãƒ»ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚VS Codeã®ã‚ˆã†ã«ã€å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥é–‹ãã€Œã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰ã€ã‚‚å¼•ãç¶šãã‚µãƒãƒ¼ãƒˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é¸æŠè‚¢ã‚’ç¶­æŒã™ã‚‹ã€‚

### ä¸»è¦ç›®æ¨™

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰**: 1ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ = 1ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¦ç®¡ç†
2. **å±¥æ­´ç®¡ç†**: è‡ªå‹•ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«ã‚ˆã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
3. **å¾Œæ–¹äº’æ›æ€§**: æ—¢å­˜ã®å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿ã‚’æœ€å°åŒ–
4. **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Web (File System Access API) ã¨ Electron (Node.js fs) ã®ä¸¡å¯¾å¿œ
5. **ãƒãƒ«ãƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: .mdi / .md / .txt ã®3å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ

### é–‹ç™ºæœŸé–“

**18é€±é–“ï¼ˆç´„4.5ãƒ¶æœˆï¼‰** - 4ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†å‰²

---

## ğŸ—‚ï¸ ç›®æ¬¡

1. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®è¨­è¨ˆ](#1-ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®è¨­è¨ˆ)
2. [æŠ€è¡“çš„ãªå®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—](#2-æŠ€è¡“çš„ãªå®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—)
3. [UI/UX ãƒ•ãƒ­ãƒ¼ã®è¨­è¨ˆ](#3-uiux-ãƒ•ãƒ­ãƒ¼ã®è¨­è¨ˆ)
4. [æ½œåœ¨çš„ãªèª²é¡Œã¨è§£æ±ºç­–](#4-æ½œåœ¨çš„ãªèª²é¡Œã¨è§£æ±ºç­–)
5. [æ®µéšçš„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—](#5-æ®µéšçš„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—)
6. [æˆåŠŸæŒ‡æ¨™ (KPI)](#6-æˆåŠŸæŒ‡æ¨™-kpi)

---

## 1. ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®è¨­è¨ˆ

### 1.1 æ¨å¥¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
my-novel/                          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ (FileSystemDirectoryHandle)
â”œâ”€â”€ main.mdi                       # ãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆ.mdi / .md / .txtï¼‰
â”œâ”€â”€ .illusions/                    # ã‚¢ãƒ—ãƒªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ project.json               # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”‚   â”œâ”€â”€ workspace.json             # ã‚¨ãƒ‡ã‚£ã‚¿çŠ¶æ…‹ï¼ˆã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç­‰ï¼‰
â”‚   â””â”€â”€ history/                   # å±¥æ­´ç®¡ç†
â”‚       â”œâ”€â”€ index.json             # å±¥æ­´ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
â”‚       â”œâ”€â”€ main.mdi.[202602011030].history
â”‚       â””â”€â”€ main.mdi.[202602011145].history
â”œâ”€â”€ assets/                        # ã‚¢ã‚»ãƒƒãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆå°†æ¥ç”¨ï¼‰
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ references/
â”œâ”€â”€ exports/                       # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‡ºåŠ›ï¼ˆå°†æ¥ç”¨ï¼‰
â”‚   â”œâ”€â”€ manuscript.pdf
â”‚   â””â”€â”€ manuscript.epub
â””â”€â”€ .gitignore                     # è‡ªå‹•ç”Ÿæˆï¼ˆ.illusionsã‚’é™¤å¤–ï¼‰
```

### 1.2 ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ä»•æ§˜

#### `.illusions/project.json`

```typescript
interface ProjectMetadata {
  version: "1.0.0";                    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³
  projectId: string;                   // UUID v4
  name: string;                        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
  mainFile: string;                    // "main.mdi" | "main.md" | "main.txt"
  mainFileExtension: ".mdi" | ".md" | ".txt";
  createdAt: number;                   // Unixã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  lastModified: number;
  author?: string;
  description?: string;
  tags?: string[];
  
  editorSettings: {
    fontScale: number;
    lineHeight: number;
    paragraphSpacing: number;
    textIndent: number;
    fontFamily: string;
    charsPerLine: number;
    showParagraphNumbers: boolean;
    mdiExtensionsEnabled: boolean;     // .mdiã®å ´åˆã®ã¿true
    posHighlightEnabled: boolean;
    posHighlightColors: Record<string, string>;
  };
}
```

#### `.illusions/workspace.json`

```typescript
interface WorkspaceState {
  editorState: {
    cursorPosition: number;            // ProseMirror doc position
    scrollTop: number;
    selectionStart?: number;
    selectionEnd?: number;
  };
  lastOpenedAt: number;
  viewState: {
    activeView: "chapters" | "settings" | "style";
    inspectorTab: "ai" | "corrections" | "stats";
    isLeftPanelCollapsed: boolean;
    isRightPanelCollapsed: boolean;
  };
}
```

#### `.illusions/history/index.json`

```typescript
interface HistoryIndex {
  snapshots: Array<{
    id: string;                        // UUID
    timestamp: number;
    filename: string;                  // "main.mdi.[202602061430].history"
    sourceFile: string;                // "main.mdi"
    type: "auto" | "manual" | "milestone";
    label?: string;                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ãƒ©ãƒ™ãƒ«
    characterCount: number;
    fileSize: number;
    checksum?: string;                 // SHA-256ãƒãƒƒã‚·ãƒ¥
  }>;
  maxSnapshots: number;                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ100
  retentionDays: number;               // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ90æ—¥
}
```

**å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡**:

```
{å…ƒãƒ•ã‚¡ã‚¤ãƒ«å}.[YYYYMMDDHHmm].history

ä¾‹:
- é›ªå¥³.mdi.[202601011520].history
- main.md.[202602061430].history
- draft.txt.[202602051600].history
```

### 1.3 ã‚¢ãƒ—ãƒªå†…çŠ¶æ…‹ç®¡ç†ã®æ‹¡å¼µ

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã¨ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰ã®å®šç¾©

```typescript
// lib/project-types.ts

/**
 * ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ™ãƒ¼ã‚¹ã®ç®¡ç†
 */
interface ProjectMode {
  type: "project";
  projectId: string;
  name: string;
  rootHandle: FileSystemDirectoryHandle;  // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒãƒ³ãƒ‰ãƒ«
  mainFileHandle: FileSystemFileHandle;   // main.mdi/md/txt ãƒãƒ³ãƒ‰ãƒ«
  metadata: ProjectMetadata;
  workspaceState: WorkspaceState;
}

/**
 * ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰: å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›´æ¥ç·¨é›†
 */
interface StandaloneMode {
  type: "standalone";
  fileHandle: FileSystemFileHandle;
  fileName: string;
  fileExtension: ".mdi" | ".md" | ".txt";
  editorSettings: ProjectMetadata["editorSettings"];
}

type EditorMode = ProjectMode | StandaloneMode | null;
```

**åˆ¤åˆ¥é–¢æ•°**:

```typescript
function isProjectMode(mode: EditorMode): mode is ProjectMode {
  return mode?.type === "project";
}

function isStandaloneMode(mode: EditorMode): mode is StandaloneMode {
  return mode?.type === "standalone";
}
```

---

## 2. æŠ€è¡“çš„ãªå®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### 2.1 FileSystemHandle ã® IndexedDB æ°¸ç¶šåŒ–

#### Dexie ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ (v2)

```typescript
// lib/web-storage.ts

interface ProjectHandleRecord {
  projectId: string;                   // Primary key
  rootHandle: FileSystemDirectoryHandle;
  lastAccessedAt: number;
  permissionState: PermissionState;
}

class IllusionsDatabase extends Dexie {
  appState!: Table<AppStateRecord>;
  recentFiles!: Table<RecentFileRecord>;
  editorBuffer!: Table<EditorBufferRecord>;
  projectHandles!: Table<ProjectHandleRecord>;  // æ–°è¦è¿½åŠ 

  constructor() {
    super("IllusionsStorage");
    
    this.version(2).stores({
      appState: "id",
      recentFiles: "path, lastModified",
      editorBuffer: "id",
      projectHandles: "projectId, lastAccessedAt",
    });
  }
}
```

#### ãƒãƒ³ãƒ‰ãƒ«å¾©å…ƒãƒ­ã‚¸ãƒƒã‚¯

```typescript
// lib/project-manager.ts

export class ProjectManager {
  /**
   * ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒãƒ³ãƒ‰ãƒ«ã‚’æ°¸ç¶šåŒ–
   */
  async saveProjectHandle(
    projectId: string, 
    rootHandle: FileSystemDirectoryHandle
  ): Promise<void> {
    const permissionState = await rootHandle.queryPermission({ mode: "readwrite" });
    
    await this.db.projectHandles.put({
      projectId,
      rootHandle,
      lastAccessedAt: Date.now(),
      permissionState,
    });
  }
  
  /**
   * IndexedDBã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ³ãƒ‰ãƒ«ã‚’å¾©å…ƒ
   */
  async restoreProjectHandle(
    projectId: string
  ): Promise<FileSystemDirectoryHandle | null> {
    const record = await this.db.projectHandles.get(projectId);
    if (!record) return null;
    
    const { rootHandle } = record;
    
    // 1. ãƒãƒ³ãƒ‰ãƒ«ã®æœ‰åŠ¹æ€§ç¢ºèª
    try {
      await rootHandle.queryPermission({ mode: "read" });
    } catch (error) {
      await this.db.projectHandles.delete(projectId);
      return null;
    }
    
    // 2. æ¨©é™ã®ç¢ºèªã¨è¦æ±‚
    let permission = await rootHandle.queryPermission({ mode: "readwrite" });
    
    if (permission === "prompt") {
      permission = await rootHandle.requestPermission({ mode: "readwrite" });
    }
    
    if (permission !== "granted") {
      return null;
    }
    
    // 3. æ¨©é™çŠ¶æ…‹ã‚’æ›´æ–°
    await this.db.projectHandles.update(projectId, {
      permissionState: "granted",
      lastAccessedAt: Date.now(),
    });
    
    return rootHandle;
  }
}
```

### 2.2 ä»®æƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ  (VFS) ãƒ¬ã‚¤ãƒ¤ãƒ¼

#### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     React Components (UI Layer)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VFS Interface (Platform-Agnostic API)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Provider  â”‚  â”‚ Electron Providerâ”‚
â”‚  (FSA API)     â”‚  â”‚  (Node.js fs)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### VFS ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```typescript
// lib/vfs/types.ts

export interface VirtualFileSystem {
  // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ“ä½œ
  openDirectory(): Promise<VFSDirectoryHandle>;
  getDirectoryHandle(path: string): Promise<VFSDirectoryHandle>;
  
  // ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
  openFile(path: string): Promise<VFSFileHandle>;
  readFile(path: string): Promise<string>;
  writeFile(path: string, content: string): Promise<void>;
  deleteFile(path: string): Promise<void>;
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  getFileMetadata(path: string): Promise<VFSFileMetadata>;
  listDirectory(path: string): Promise<VFSEntry[]>;
  
  // ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
  watchFile?(path: string, callback: (event: VFSWatchEvent) => void): VFSWatcher;
}
```

#### Webå®Ÿè£… (File System Access API)

```typescript
// lib/vfs/web-vfs.ts

export class WebVFS implements VirtualFileSystem {
  private rootHandle: FileSystemDirectoryHandle | null = null;
  
  async openDirectory(): Promise<VFSDirectoryHandle> {
    this.rootHandle = await window.showDirectoryPicker({
      mode: "readwrite",
    });
    return this.wrapDirectoryHandle(this.rootHandle, "/");
  }
  
  async readFile(path: string): Promise<string> {
    const fileHandle = await this.resolvePathToFile(path);
    const file = await fileHandle.getFile();
    return await file.text();
  }
  
  async writeFile(path: string, content: string): Promise<void> {
    const fileHandle = await this.resolvePathToFile(path);
    const writable = await fileHandle.createWritable();
    await writable.write(content);
    await writable.close();
  }
  
  // ... å®Ÿè£…ã®è©³ç´°ã¯æœ¬æ–‡å‚ç…§
}
```

#### Electronå®Ÿè£… (Node.js fs)

```typescript
// lib/vfs/electron-vfs.ts

export class ElectronVFS implements VirtualFileSystem {
  private rootPath: string | null = null;
  
  async openDirectory(): Promise<VFSDirectoryHandle> {
    const result = await window.electronAPI.showOpenDialog({
      properties: ["openDirectory"],
    });
    
    if (result.canceled) throw new Error("Cancelled");
    
    this.rootPath = result.filePaths[0];
    return this.getDirectoryHandle("/");
  }
  
  async readFile(path: string): Promise<string> {
    const absolutePath = this.resolvePath(path);
    return await window.electronAPI.readFile(absolutePath);
  }
  
  // ... å®Ÿè£…ã®è©³ç´°ã¯æœ¬æ–‡å‚ç…§
}
```

### 2.3 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µãƒ¼ãƒ“ã‚¹

```typescript
// lib/project-service.ts

export class ProjectService {
  private vfs = getVFS();
  
  /**
   * æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
   */
  async createProject(
    name: string,
    fileExtension: ".mdi" | ".md" | ".txt" = ".mdi"
  ): Promise<ProjectMode> {
    const rootHandle = await this.vfs.openDirectory();
    const projectId = uuidv4();
    const mainFileName = `main${fileExtension}`;
    
    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
    const metadata: ProjectMetadata = {
      version: "1.0.0",
      projectId,
      name,
      mainFile: mainFileName,
      mainFileExtension: fileExtension,
      createdAt: Date.now(),
      lastModified: Date.now(),
      editorSettings: this.getDefaultEditorSettings(fileExtension),
    };
    
    // .illusionsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    const illusionsDir = await rootHandle.getDirectoryHandle(".illusions", { create: true });
    
    // project.jsonä½œæˆ
    const projectFile = await illusionsDir.getFileHandle("project.json", { create: true });
    await projectFile.write(JSON.stringify(metadata, null, 2));
    
    // ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
    const mainFile = await rootHandle.getFileHandle(mainFileName, { create: true });
    await mainFile.write(this.getInitialContent(fileExtension));
    
    // workspace.json, historyãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    const workspaceState = this.getDefaultWorkspaceState();
    const workspaceFile = await illusionsDir.getFileHandle("workspace.json", { create: true });
    await workspaceFile.write(JSON.stringify(workspaceState, null, 2));
    
    await illusionsDir.getDirectoryHandle("history", { create: true });
    
    // .gitignoreè‡ªå‹•ç”Ÿæˆ
    await this.createGitignore(rootHandle);
    
    // ãƒãƒ³ãƒ‰ãƒ«æ°¸ç¶šåŒ–
    await this.projectManager.saveProjectHandle(projectId, rootHandle);
    
    return {
      type: "project",
      projectId,
      name,
      rootHandle,
      mainFileHandle: mainFile,
      metadata,
      workspaceState,
    };
  }
  
  /**
   * æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã
   */
  async openProject(): Promise<ProjectMode> {
    const rootHandle = await this.vfs.openDirectory();
    
    // .illusions/project.jsonã‚’èª­ã¿è¾¼ã¿
    const illusionsDir = await rootHandle.getDirectoryHandle(".illusions");
    const projectFile = await illusionsDir.getFileHandle("project.json");
    const metadataText = await projectFile.read();
    const metadata: ProjectMetadata = JSON.parse(metadataText);
    
    // workspace.jsonã‚’èª­ã¿è¾¼ã¿
    const workspaceFile = await illusionsDir.getFileHandle("workspace.json");
    const workspaceText = await workspaceFile.read();
    const workspaceState: WorkspaceState = JSON.parse(workspaceText);
    
    // main fileãƒãƒ³ãƒ‰ãƒ«ã‚’å–å¾—
    const mainFileHandle = await rootHandle.getFileHandle(metadata.mainFile);
    
    // ãƒãƒ³ãƒ‰ãƒ«æ°¸ç¶šåŒ–
    await this.projectManager.saveProjectHandle(metadata.projectId, rootHandle);
    
    return {
      type: "project",
      projectId: metadata.projectId,
      name: metadata.name,
      rootHandle,
      mainFileHandle,
      metadata,
      workspaceState,
    };
  }
  
  /**
   * å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãï¼ˆã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰ï¼‰
   */
  async openStandaloneFile(): Promise<StandaloneMode> {
    const [fileHandle] = await window.showOpenFilePicker({
      types: [
        {
          description: "ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«",
          accept: {
            "text/plain": [".txt"],
            "text/markdown": [".md"],
            "text/x-mdi": [".mdi"],
          },
        },
      ],
    });
    
    const fileExtension = this.getFileExtension(fileHandle.name);
    
    return {
      type: "standalone",
      fileHandle,
      fileName: fileHandle.name,
      fileExtension,
      editorSettings: this.getDefaultEditorSettings(fileExtension),
    };
  }
  
  private getInitialContent(fileExtension: string): string {
    switch (fileExtension) {
      case ".mdi":
        return "# æ–°ã—ã„ç‰©èª\n\nã“ã“ã‹ã‚‰æ›¸ãå§‹ã‚ã¦ãã ã•ã„ã€‚\n\n{æ¼¢å­—|ã‹ã‚“ã˜}ã®ãƒ«ãƒ“ã‚„^ç¸¦ä¸­æ¨ª^ã‚‚ä½¿ãˆã¾ã™ã€‚\n";
      case ".md":
        return "# æ–°ã—ã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\n\nMarkdownå½¢å¼ã§æ›¸ãå§‹ã‚ã¦ãã ã•ã„ã€‚\n";
      case ".txt":
        return "æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«\n\nã“ã“ã‹ã‚‰æ›¸ãå§‹ã‚ã¦ãã ã•ã„ã€‚\n";
    }
  }
  
  private async createGitignore(rootHandle: FileSystemDirectoryHandle): Promise<void> {
    const gitignoreContent = `# Illusions ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
.illusions/
*.history

# ã‚¨ãƒ‡ã‚£ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
*.bak
*.tmp
`;
    
    try {
      const gitignoreHandle = await rootHandle.getFileHandle(".gitignore", { create: true });
      await gitignoreHandle.write(gitignoreContent);
    } catch (error) {
      console.warn("Failed to create .gitignore:", error);
    }
  }
}
```

### 2.4 å±¥æ­´ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹

```typescript
// lib/history-service.ts

export class HistoryService {
  /**
   * ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆ
   */
  async createSnapshot(
    project: ProjectMode,
    content: string,
    type: "auto" | "manual" | "milestone" = "auto",
    label?: string
  ): Promise<void> {
    const timestamp = Date.now();
    
    // ãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ: "main.mdi.[202602061430].history"
    const sourceFileName = project.metadata.mainFile;
    const dateStr = format(timestamp, "yyyyMMddHHmm");
    const filename = `${sourceFileName}.[${dateStr}].history`;
    
    // ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
    const illusionsDir = await project.rootHandle.getDirectoryHandle(".illusions");
    const historyDir = await illusionsDir.getDirectoryHandle("history");
    const snapshotFile = await historyDir.getFileHandle(filename, { create: true });
    
    const writable = await snapshotFile.createWritable();
    await writable.write(content);
    await writable.close();
    
    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¨ˆç®—
    const characterCount = content.length;
    const fileSize = new Blob([content]).size;
    const checksum = await this.calculateChecksum(content);
    
    // å±¥æ­´ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ›´æ–°
    const index = await this.loadHistoryIndex(project);
    index.snapshots.push({
      id: uuidv4(),
      timestamp,
      filename,
      sourceFile: sourceFileName,
      type,
      label,
      characterCount,
      fileSize,
      checksum,
    });
    
    index.snapshots.sort((a, b) => b.timestamp - a.timestamp);
    await this.saveHistoryIndex(project, index);
    
    // å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå‰Šé™¤
    await this.pruneOldSnapshots(project);
  }
  
  /**
   * ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å¾©å…ƒ
   */
  async restoreSnapshot(
    project: ProjectMode,
    snapshotId: string
  ): Promise<string> {
    const index = await this.loadHistoryIndex(project);
    const snapshot = index.snapshots.find(s => s.id === snapshotId);
    
    if (!snapshot) {
      throw new Error(`Snapshot not found: ${snapshotId}`);
    }
    
    const illusionsDir = await project.rootHandle.getDirectoryHandle(".illusions");
    const historyDir = await illusionsDir.getDirectoryHandle("history");
    const snapshotFile = await historyDir.getFileHandle(snapshot.filename);
    
    const file = await snapshotFile.getFile();
    const content = await file.text();
    
    // ãƒã‚§ãƒƒã‚¯ã‚µãƒ æ¤œè¨¼
    if (snapshot.checksum) {
      const actualChecksum = await this.calculateChecksum(content);
      if (actualChecksum !== snapshot.checksum) {
        console.warn(`Checksum mismatch for ${snapshot.filename}`);
      }
    }
    
    return content;
  }
  
  /**
   * å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å‰Šé™¤
   */
  async pruneOldSnapshots(project: ProjectMode): Promise<void> {
    const index = await this.loadHistoryIndex(project);
    const now = Date.now();
    const retentionPeriod = index.retentionDays * 24 * 60 * 60 * 1000;
    
    // ä¿æŒæœŸé–“å†…ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    const validSnapshots = index.snapshots.filter(snapshot => {
      if (snapshot.type === "milestone") return true;
      return now - snapshot.timestamp < retentionPeriod;
    });
    
    // æœ€å¤§ä»¶æ•°ã‚’è¶…ãˆã‚‹å ´åˆã¯å‰Šé™¤
    const milestones = validSnapshots.filter(s => s.type === "milestone");
    const autoSnapshots = validSnapshots
      .filter(s => s.type !== "milestone")
      .slice(0, index.maxSnapshots);
    
    const keptSnapshots = [...milestones, ...autoSnapshots];
    const keptFilenames = new Set(keptSnapshots.map(s => s.filename));
    const deletedSnapshots = index.snapshots.filter(
      s => !keptFilenames.has(s.filename)
    );
    
    // ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
    if (deletedSnapshots.length > 0) {
      const illusionsDir = await project.rootHandle.getDirectoryHandle(".illusions");
      const historyDir = await illusionsDir.getDirectoryHandle("history");
      
      for (const snapshot of deletedSnapshots) {
        try {
          await historyDir.removeEntry(snapshot.filename);
        } catch (error) {
          console.warn(`Failed to delete ${snapshot.filename}:`, error);
        }
      }
    }
    
    index.snapshots = keptSnapshots;
    await this.saveHistoryIndex(project, index);
  }
  
  private async calculateChecksum(content: string): Promise<string> {
    const encoder = new TextEncoder();
    const data = encoder.encode(content);
    const hashBuffer = await crypto.subtle.digest("SHA-256", data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
  }
}
```

---

## 3. UI/UX ãƒ•ãƒ­ãƒ¼ã®è¨­è¨ˆ

### 3.1 ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Illusions                         â”‚
â”‚                                                    â”‚
â”‚        æ—¥æœ¬èªå°èª¬ã‚’æ›¸ããŸã‚ã®ã‚¨ãƒ‡ã‚£ã‚¿               â”‚
â”‚                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚ ğŸ“ æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆâ”‚  â”‚ ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãâ”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  ğŸ“„ å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã          â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                    â”‚
â”‚   æœ€è¿‘ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ:                              â”‚
â”‚   â€¢ ğŸ“˜ æ˜¥ã®ç‰©èª (.mdi) - 2æ™‚é–“å‰                   â”‚
â”‚   â€¢ ğŸ“ è¨­å®šè³‡æ–™ (.md) - æ˜¨æ—¥                      â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰

**Step 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¨ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®é¸æŠ**

```typescript
// components/CreateProjectWizard.tsx

<div className="wizard-step">
  <label>
    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
    <input type="text" placeholder="ä¾‹: æ˜¥ã®ç‰©èª" />
  </label>
  
  <fieldset>
    <legend>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’é¸æŠ</legend>
    
    <label>
      <input type="radio" name="format" value=".mdi" />
      <strong>.mdiï¼ˆæ¨å¥¨ï¼‰</strong>
      <p>æ—¥æœ¬èªå°èª¬å‘ã‘ã€‚ãƒ«ãƒ“ã€ç¸¦ä¸­æ¨ªã€kerningèª¿æ•´ãŒä½¿ãˆã¾ã™ã€‚</p>
    </label>
    
    <label>
      <input type="radio" name="format" value=".md" />
      <strong>.mdï¼ˆMarkdownï¼‰</strong>
      <p>æ¨™æº–Markdownå½¢å¼ã€‚æŠ€è¡“æ–‡æ›¸ã‚„ãƒ–ãƒ­ã‚°è¨˜äº‹ã«æœ€é©ã€‚</p>
    </label>
    
    <label>
      <input type="radio" name="format" value=".txt" />
      <strong>.txtï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰</strong>
      <p>ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã€‚ä¸‹æ›¸ãã‚„ãƒ¡ãƒ¢ã«ã€‚</p>
    </label>
  </fieldset>
</div>
```

**Step 2: ä¿å­˜å ´æ‰€é¸æŠ**

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ”ãƒƒã‚«ãƒ¼ã‚’è¡¨ç¤ºã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠã€‚

**Step 3: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆä¸­**

ã‚¹ãƒ”ãƒŠãƒ¼ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã€‚

### 3.3 ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ææ¡ˆ

```typescript
// components/UpgradeToProjectBanner.tsx

<div className="upgrade-banner">
  <span className="icon">ğŸ’¡</span>
  <div>
    <h4>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’ãŠã™ã™ã‚ã—ã¾ã™</h4>
    <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã«ã™ã‚‹ã¨ã€è‡ªå‹•å±¥æ­´ç®¡ç†ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚</p>
  </div>
  <button onClick={onUpgrade}>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›</button>
  <button onClick={onDismiss}>ä»Šã¯ã—ãªã„</button>
</div>
```

**è¡¨ç¤ºã‚¿ã‚¤ãƒŸãƒ³ã‚°**:
1. åˆå›ä¿å­˜æ™‚
2. 5,000æ–‡å­—åˆ°é”æ™‚
3. 3å›ç›®ã®ä¿å­˜æ™‚

### 3.4 å±¥æ­´ãƒ‘ãƒãƒ«ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰å°‚ç”¨ï¼‰

```typescript
// components/HistoryPanel.tsx

<div className="history-panel">
  <h3>è‡ªå‹•ä¿å­˜å±¥æ­´</h3>
  
  <ul className="snapshot-list">
    <li className="snapshot-item milestone">
      <div className="snapshot-header">
        <span>2026å¹´02æœˆ06æ—¥ 14:30</span>
        <span className="milestone-badge">ğŸ“Œ ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</span>
      </div>
      <div className="snapshot-label">ç¬¬3ç« å®Œæˆæ™‚</div>
      <div className="snapshot-meta">
        <span>12,450æ–‡å­—</span>
        <span>35.2 KB</span>
      </div>
      <button>å¾©å…ƒ</button>
    </li>
    
    <li className="snapshot-item auto">
      <span>2026å¹´02æœˆ06æ—¥ 14:25</span>
      <span>12,380æ–‡å­—</span>
      <button>å¾©å…ƒ</button>
      <button>é‡è¦ã«ã™ã‚‹</button>
    </li>
  </ul>
</div>
```

---

## 4. æ½œåœ¨çš„ãªèª²é¡Œã¨è§£æ±ºç­–

### 4.1 ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶é™

#### èª²é¡Œ1: æ¨©é™ã®æ°¸ç¶šåŒ–åˆ¶é™

**å•é¡Œ**: File System Access API ã®æ¨©é™ãŒãƒ–ãƒ©ã‚¦ã‚¶å†èµ·å‹•å¾Œã«å¤±åŠ¹ã™ã‚‹å¯èƒ½æ€§ã€‚

**è§£æ±ºç­–**:
1. æ¨©é™çŠ¶æ…‹ã®äº‹å‰ãƒã‚§ãƒƒã‚¯
2. å¤±åŠ¹æ™‚ã¯ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã¸èª˜å°
3. Electronç’°å¢ƒã§ã¯çµ¶å¯¾ãƒ‘ã‚¹ã§ç›´æ¥é–‹ã

#### èª²é¡Œ2: Safariãƒ»Firefox ã®éå¯¾å¿œ

**å•é¡Œ**: File System Access API æœªå¯¾å¿œã€‚

**è§£æ±ºç­–**:
1. æ©Ÿèƒ½æ¤œå‡ºã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
2. UI ã§ã®éå¯¾å¿œè¡¨ç¤º
3. IndexedDB ãƒ™ãƒ¼ã‚¹ã®ä»£æ›¿å®Ÿè£…ï¼ˆPhase 5+ï¼‰

### 4.2 ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ¤œçŸ¥

#### èª²é¡Œ3: å¤–éƒ¨ã‚¨ãƒ‡ã‚£ã‚¿ã§ã®åŒæ™‚ç·¨é›†

**å•é¡Œ**: VS Codeç­‰ã§åŒæ™‚ç·¨é›†ã—ãŸéš›ã®ãƒ‡ãƒ¼ã‚¿ç«¶åˆã€‚

**è§£æ±ºç­–**:

**Electron**: chokidar ã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–

```typescript
// main.js
chokidar.watch(`${projectPath}/main.mdi`).on("change", (path) => {
  event.sender.send("project:file-changed", { path, content });
});
```

**Web**: å®šæœŸçš„ãªã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒã‚§ãƒƒã‚¯ï¼ˆ5ç§’ã”ã¨ï¼‰

```typescript
// lib/file-watcher.ts
setInterval(async () => {
  const file = await fileHandle.getFile();
  if (file.lastModified > this.lastModified) {
    this.onChanged(await file.text());
  }
}, 5000);
```

**ç«¶åˆUI**:

```typescript
// components/FileConflictDialog.tsx
<div>
  <h2>ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤–éƒ¨ã§å¤‰æ›´ã•ã‚Œã¾ã—ãŸ</h2>
  <button onClick={() => onResolve("local")}>ã‚¨ãƒ‡ã‚£ã‚¿ã®å†…å®¹ã‚’ä¿æŒ</button>
  <button onClick={() => onResolve("remote")}>ãƒ‡ã‚£ã‚¹ã‚¯ã®å†…å®¹ã§ä¸Šæ›¸ã</button>
</div>
```

### 4.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

#### èª²é¡Œ4: å¤§é‡ã®å±¥æ­´ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

**å•é¡Œ**: `.illusions/history/` ã®è‚¥å¤§åŒ–ã€‚

**è§£æ±ºç­–**:
1. ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ: 5åˆ†ä»¥å†…ã®å¤‰æ›´ã¯çµ±åˆ
2. æœ€å¤§100ä»¶ä¿æŒï¼ˆãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é™¤ãï¼‰
3. 90æ—¥ä»¥ä¸Šå‰ã¯è‡ªå‹•å‰Šé™¤

### 4.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

#### èª²é¡Œ6: .illusions ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¼æ´©

**å•é¡Œ**: Gitã«èª¤ã£ã¦ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹å¯èƒ½æ€§ã€‚

**è§£æ±ºç­–**:
1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ `.gitignore` ã®è‡ªå‹•ç”Ÿæˆ
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ™‚ã®è­¦å‘Šè¡¨ç¤º

---

## 5. æ®µéšçš„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### ãƒ•ã‚§ãƒ¼ã‚º1: ã‚³ã‚¢APIå®Ÿè£…ï¼ˆ4-6é€±é–“ï¼‰

**Week 1-2: VFSãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å®Ÿè£…**
- [ ] VFSå‹å®šç¾© (`lib/vfs/types.ts`)
- [ ] Web VFSå®Ÿè£… (`lib/vfs/web-vfs.ts`)
- [ ] Electron VFSå®Ÿè£… (`lib/vfs/electron-vfs.ts`)
- [ ] VFS ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ (`lib/vfs/index.ts`)

**Week 3-4: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‹å®šç¾© (`lib/project-types.ts`)
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ (`lib/project-manager.ts`)
- [ ] IndexedDBã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µï¼ˆDexie v2ï¼‰
- [ ] æ¨©é™ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ (`lib/permission-manager.ts`)

**Week 5-6: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã¨CRUD**
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µãƒ¼ãƒ“ã‚¹ (`lib/project-service.ts`)
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåˆæœŸåŒ–
- [ ] Electron IPCæ‹¡å¼µ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ

**å®Œäº†åŸºæº–**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆãƒ»é–‹ããƒ»ä¿å­˜ãŒå‹•ä½œ
- Web/Electronã®ä¸¡ç’°å¢ƒã§å‹•ä½œ
- å˜ä½“ãƒ†ã‚¹ãƒˆãŒå…¨ã¦ãƒ‘ã‚¹

---

### ãƒ•ã‚§ãƒ¼ã‚º2: UI/UXçµ±åˆï¼ˆ3-4é€±é–“ï¼‰

**Week 7-8: ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã¨èµ·å‹•ãƒ•ãƒ­ãƒ¼**
- [ ] WelcomeScreenã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] CreateProjectWizardã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] ã‚¢ãƒ—ãƒªèµ·å‹•ãƒ•ãƒ­ãƒ¼æ”¹ä¿®
- [ ] çŠ¶æ…‹ç®¡ç†ã®æ‹¡å¼µï¼ˆ`editorMode`ï¼‰

**Week 9: ã‚¨ãƒ‡ã‚£ã‚¿UIã®æ‹¡å¼µ**
- [ ] Inspectorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ‹¡å¼µ
- [ ] Explorerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ‹¡å¼µ
- [ ] PermissionPromptã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**Week 10: ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼**
- [ ] UpgradeToProjectBannerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] ProjectUpgradeService
- [ ] ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰çµ±åˆ

**å®Œäº†åŸºæº–**:
- ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‹ã‚‰å…¨æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰ãŒåŒºåˆ¥ã§ãã‚‹
- ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå‹•ä½œ

---

### ãƒ•ã‚§ãƒ¼ã‚º3: å±¥æ­´ç®¡ç†ã¨é«˜åº¦ãªæ©Ÿèƒ½ï¼ˆ4-5é€±é–“ï¼‰

**Week 11-12: å±¥æ­´ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…**
- [ ] HistoryServiceã‚¯ãƒ©ã‚¹
- [ ] `createSnapshot()` å®Ÿè£…
- [ ] `restoreSnapshot()` å®Ÿè£…
- [ ] ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿æŒãƒãƒªã‚·ãƒ¼

**Week 13: å±¥æ­´ãƒ‘ãƒãƒ«UI**
- [ ] HistoryPanelã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¸€è¦§è¡¨ç¤º
- [ ] å¾©å…ƒãƒ•ãƒ­ãƒ¼
- [ ] å·®åˆ†è¡¨ç¤º

**Week 14: ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ¤œçŸ¥**
- [ ] FileWatcherã‚¯ãƒ©ã‚¹ï¼ˆWebï¼‰
- [ ] Electron ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ï¼ˆchokidarï¼‰
- [ ] FileConflictDialogã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] ç«¶åˆè§£æ±ºãƒ•ãƒ­ãƒ¼

**Week 15: çµ±åˆãƒ†ã‚¹ãƒˆã¨æœ€é©åŒ–**
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

**å®Œäº†åŸºæº–**:
- å±¥æ­´ç®¡ç†ãŒå®Œå…¨ã«å‹•ä½œ
- å¤–éƒ¨å¤‰æ›´ãŒæ¤œçŸ¥ã•ã‚Œã‚‹
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå®Ÿç”¨ãƒ¬ãƒ™ãƒ«

---

### ãƒ•ã‚§ãƒ¼ã‚º4: ãƒãƒªãƒƒã‚·ãƒ¥ã¨æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ï¼ˆ2-3é€±é–“ï¼‰

**Week 16: ãƒã‚°ä¿®æ­£ã¨å®‰å®šåŒ–**
- [ ] ãƒã‚°ãƒˆãƒªã‚¢ãƒ¼ã‚¸
- [ ] ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ
- [ ] Electronãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ

**Week 17: ãƒªãƒªãƒ¼ã‚¹æº–å‚™**
- [ ] ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆä½œæˆ
- [ ] ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ„ãƒ¼ãƒ«
- [ ] ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹çµ±åˆ

**Week 18: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤**
- [ ] ãƒ™ãƒ¼ã‚¿ç‰ˆãƒªãƒªãƒ¼ã‚¹
- [ ] ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†
- [ ] æ­£å¼ãƒªãƒªãƒ¼ã‚¹

**å®Œäº†åŸºæº–**:
- æ—¢çŸ¥ã®ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒã‚°ãŒã‚¼ãƒ­
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œæˆ
- æœ¬ç•ªç’°å¢ƒã§æ­£å¸¸ç¨¼åƒ

---

## 6. æˆåŠŸæŒ‡æ¨™ (KPI)

### æŠ€è¡“æŒ‡æ¨™
- **APIå¿œç­”æ™‚é–“**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ < 3ç§’ã€ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ < 500ms
- **æ¨©é™å¾©å…ƒæˆåŠŸç‡**: 90%ä»¥ä¸Šï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å†èµ·å‹•å¾Œï¼‰
- **ã‚¨ãƒ©ãƒ¼ç‡**: < 1%ï¼ˆå…¨ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œï¼‰

### ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ¨™
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰æ¡ç”¨ç‡**: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®60%ä»¥ä¸Š
- **æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç§»è¡Œç‡**: 30%ä»¥ä¸Šï¼ˆ3ãƒ¶æœˆä»¥å†…ï¼‰
- **å±¥æ­´æ©Ÿèƒ½åˆ©ç”¨ç‡**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®40%ä»¥ä¸Š

### å“è³ªæŒ‡æ¨™
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Šï¼ˆã‚³ã‚¢APIï¼‰
- **ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒã‚°**: ãƒªãƒªãƒ¼ã‚¹å‰ã«ã‚¼ãƒ­
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦**: NPS 50ä»¥ä¸Š

---

## 7. ãƒªã‚¹ã‚¯ã¨ç·©å’Œç­–

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | ç™ºç”Ÿç¢ºç‡ | ç·©å’Œç­– |
|--------|--------|----------|--------|
| File System Access API ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆä¸è¶³ | é«˜ | ä¸­ | Safari/Firefoxå‘ã‘ã®ä»£æ›¿UIã€Electronã¸ã®èª˜å° |
| æ¨©é™ã®æ°¸ç¶šåŒ–å•é¡Œ | ä¸­ | é«˜ | ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€å†é¸æŠãƒ•ãƒ­ãƒ¼ |
| é–‹ç™ºæœŸé–“ã®è¶…é | ä¸­ | ä¸­ | ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã®å³å¯†ãªé€²æ—ç®¡ç†ã€ã‚¹ã‚³ãƒ¼ãƒ—å‰Šæ¸› |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ··ä¹±ï¼ˆ2ãƒ¢ãƒ¼ãƒ‰ä¸¦å­˜ï¼‰ | ä½ | ä¸­ | æ˜ç¢ºãªUIè¡¨ç¤ºã€è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |

---

## 8. å°†æ¥ã®æ‹¡å¼µè¨ˆç”»ï¼ˆPhase 5ä»¥é™ï¼‰

### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
- **ãƒãƒ«ãƒãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ**: ç« ã”ã¨ã« `.mdi` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²
- **ã‚¢ã‚»ãƒƒãƒˆç®¡ç†**: ç”»åƒãƒ»å‚è€ƒè³‡æ–™ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ç®¡ç†
- **Gitçµ±åˆ**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®è‡ªå‹•åŒ–
- **ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: è¤‡æ•°äººã§ã®å…±åŒç·¨é›†
- **ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ**: Google Drive / Dropbox çµ±åˆ
- **IndexedDB VFS**: Safari/Firefoxå‘ã‘ã®å®Œå…¨ãªä»£æ›¿å®Ÿè£…

---

## 9. ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚µãƒãƒ¼ãƒˆãƒãƒˆãƒªã‚¯ã‚¹

| æ©Ÿèƒ½ | .mdi | .md | .txt |
|------|------|-----|------|
| åŸºæœ¬ç·¨é›† | âœ… | âœ… | âœ… |
| Markdownæ§‹æ–‡ | âœ… | âœ… | âŒ |
| MDIæ‹¡å¼µï¼ˆãƒ«ãƒ“ï¼‰ | âœ… | âŒ | âŒ |
| MDIæ‹¡å¼µï¼ˆç¸¦ä¸­æ¨ªï¼‰ | âœ… | âŒ | âŒ |
| å“è©ãƒã‚¤ãƒ©ã‚¤ãƒˆ | âœ… | âŒ | âŒ |
| å±¥æ­´ç®¡ç† | âœ… | âœ… | âœ… |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ | âœ… | âœ… | âœ… |

---

## 10. å‚è€ƒè³‡æ–™

### File System Access API
- [MDN: File System Access API](https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API)
- [Chrome Developers: File System Access](https://developer.chrome.com/articles/file-system-access/)

### IndexedDB
- [Dexie.js Documentation](https://dexie.org/)

### VS Code ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- [VS Code Workspace Concept](https://code.visualstudio.com/docs/editor/workspaces)

---

## 11. å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|-----------|------|----------|
| 1.0.0 | 2026-02-06 | åˆç‰ˆä½œæˆ |

---

**æ‰¿èªè€…**: _________________  
**æ—¥ä»˜**: _________________
